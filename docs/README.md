# Seven Knights 자동 매크로 v1.0

Seven Knights 게임의 자동 전투 매크로입니다. 화면 인식을 통해 승리/패배를 판단하고 자동으로 전투를 반복합니다.

## 🚀 주요 기능

- **이미지 매칭 기반 자동화**: OpenCV를 사용한 정확한 화면 인식
- **승리/패배 자동 처리**: 전투 결과에 따른 자동 클릭
- **안전한 실행**: 다양한 중단 조건 및 FailSafe 기능
- **실시간 통계**: 승률, 전투 횟수, 실행 시간 등
- **디버깅 도구**: 자동 스크린샷 저장 및 로그 시스템
- **키보드 단축키**: 실시간 매크로 제어

## 📋 필요 조건

- **운영체제**: Windows 10/11
- **Python**: 3.8 이상
- **게임**: Seven Knights (PC 버전)
- **해상도**: 1920x1080 권장 (다른 해상도도 지원)

## 🛠️ 설치 방법

### 1. 저장소 복제
```bash
git clone https://github.com/yourusername/seven_knights_auto
cd seven_knights_auto
```

### 2. 의존성 설치
```bash
pip install -r requirements.txt
```

### 3. 디렉토리 구조
설치 후 다음과 같은 구조가 생성됩니다:
```
seven_knights_auto/
├── seven_knights_macro.py      # 메인 매크로 프로그램
├── image_capture_tool.py       # 이미지 캡처 도구
├── config.py                   # 설정 관리
├── requirements.txt            # 필요한 패키지
├── README.md                   # 사용법 (이 파일)
├── images/                     # 버튼 이미지 저장
├── logs/                       # 로그 파일
└── screenshots/                # 디버그 스크린샷
```

## 🎮 사용 방법

### 1단계: 이미지 캡처
매크로를 실행하기 전에 게임 버튼들의 이미지를 캡처해야 합니다.

```bash
python image_capture_tool.py
```

**필수 캡처 이미지:**
- ✅ **패배 후 다시하기 버튼**: 전투 패배 시 나타나는 "다시하기" 버튼
- ✅ **승리 화면**: 전투 승리 시 나타나는 "승리" 텍스트  
- ✅ **승리 후 다음 지역 버튼**: 전투 승리 시 나타나는 "다음 지역" 버튼
- ✅ **전투 시작 버튼**: 다음 전투를 시작하는 버튼

**선택 캡처 이미지:**
- 🔶 **경고 팝업**: 매크로 중단이 필요한 경고창
- 🔶 **에너지 부족 알림**: 에너지가 부족할 때 나타나는 알림
- 🔶 **점검 중 알림**: 서버 점검 시 나타나는 알림

### 2단계: 매크로 실행
```bash
python seven_knights_macro.py
```

### 3단계: 매크로 제어
- **F9**: 매크로 시작/중지
- **F10**: 매크로 완전 종료
- **F11**: 실시간 통계 출력
- **F12**: 수동 스크린샷 저장
- **마우스 좌상단 이동**: 긴급 중지 (FailSafe)

## ⚙️ 설정 변경

### 기본 설정
`config.py`를 실행하여 현재 설정을 확인할 수 있습니다:
```bash
python config.py
```

### 주요 설정 항목
```python
# 이미지 매칭 정확도
match_threshold = 0.8          # 기본 임계값 (0.7~0.9)

# 클릭 딜레이
click_delay = 0.5              # 클릭 후 대기 시간
scan_delay = 1.5               # 화면 스캔 간격

# 안전 설정
max_consecutive_failures = 5   # 연속 실패 허용 횟수
max_runtime_hours = 12         # 최대 실행 시간
```

### 프리셋 적용
미리 정의된 설정 프로필을 사용할 수 있습니다:

```python
from config import apply_preset

# 빠른 실행 모드 (정확도 약간 낮음)
apply_preset("fast")

# 안전 모드 (느리지만 안정적)
apply_preset("safe")

# 정확 모드 (높은 정확도)
apply_preset("accurate")
```

## 🔧 고급 기능

### 1. 화면 해상도 적응
매크로는 다양한 해상도에서 작동하지만, 이미지 매칭 정확도를 높이려면:

1. **게임 해상도 고정**: 게임을 전체화면이나 고정 크기로 설정
2. **임계값 조정**: 해상도에 따라 `match_threshold` 값 조정
3. **이미지 재캡처**: 해상도 변경 시 버튼 이미지 재캡처

### 2. 병렬 처리
여러 매크로 루틴을 동시에 실행하려면:

```python
# config.py에서 설정 변경
parallel_processing = True
```

### 3. 디버깅 모드
문제 해결을 위한 디버깅 기능:

```python
# 상세 로그 활성화
enable_detailed_logging = True
log_level = "DEBUG"

# 자동 스크린샷 저장
save_debug_screenshots = True
```

## 📊 통계 및 모니터링

### 실시간 통계
- **승리 횟수**: 성공한 전투 수
- **패배 횟수**: 실패한 전투 수  
- **승률**: 전체 승률 계산
- **실행 시간**: 총 실행 시간
- **재시작 횟수**: 매크로 재시작 횟수

### 로그 파일
모든 활동이 `logs/seven_knights_macro.log`에 기록됩니다.

### 스크린샷
오류 발생 시 자동으로 `screenshots/` 폴더에 저장됩니다.

## 🛡️ 안전 기능

### 1. FailSafe 시스템
- 마우스를 화면 좌상단으로 이동하면 즉시 중지
- 연속 실패 시 자동 중지
- 최대 실행 시간 제한

### 2. 자동 중단 조건
- 경고 팝업 감지
- 에너지 부족 감지
- 서버 점검 감지

### 3. 예외 처리
- 이미지 로드 실패
- 화면 캡처 오류
- 클릭 실패 등

## 🚨 문제 해결

### 자주 발생하는 문제

**Q: 매크로가 버튼을 인식하지 못해요**
```
A: 다음을 확인해보세요:
1. 이미지가 올바르게 캡처되었는지 확인
2. match_threshold 값을 낮춰보세요 (0.7~0.8)
3. 게임 해상도나 창 크기가 변경되었는지 확인
4. F12로 현재 화면을 캡처하여 비교
```

**Q: 매크로가 너무 빨리/느리게 작동해요**
```
A: config.py에서 딜레이 값을 조정:
- 빠르게: click_delay=0.3, scan_delay=1.0
- 느리게: click_delay=0.8, scan_delay=2.0
```

**Q: 매크로가 자주 중단돼요**
```
A: 안전 설정을 완화:
- max_consecutive_failures를 늘려보세요
- match_threshold를 낮춰보세요
- 중단 조건 이미지들을 확인해보세요
```

### 디버깅 단계
1. **이미지 매칭 테스트**: 캡처 도구에서 "이미지 매칭 테스트" 실행
2. **로그 확인**: `logs/seven_knights_macro.log` 파일 확인
3. **스크린샷 확인**: `screenshots/` 폴더의 디버그 이미지 확인
4. **설정 검증**: `python config.py` 실행하여 설정 확인

## 📝 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

## ⚠️ 주의사항

1. **게임 약관 확인**: 게임 운영정책에 따라 매크로 사용이 제한될 수 있습니다
2. **백그라운드 실행 권장**: 매크로 실행 중 다른 프로그램 사용 시 간섭 가능
3. **정기적 확인**: 게임 업데이트 시 이미지 재캡처 필요
4. **시스템 리소스**: 장시간 실행 시 CPU/메모리 사용량 모니터링

## 🤝 기여하기

버그 리포트, 기능 제안, 코드 개선 등 모든 기여를 환영합니다!

1. 이슈 작성 또는 Fork
2. 기능 브랜치 생성
3. 변경사항 커밋
4. Pull Request 생성

---

**Happy Gaming! 🎮** 