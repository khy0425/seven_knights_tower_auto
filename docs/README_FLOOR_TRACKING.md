# 🏰 Seven Knights 무한의 탑 층수 추적 시스템

## 📋 개요

Seven Knights 무한의 탑 매크로에 **층수 인식 및 추적 기능**을 추가한 개선된 버전입니다. 
OCR 기술을 활용하여 승리/패배 시 자동으로 층수를 인식하고, 해당 층수의 스크린샷을 한 번만 저장하며, 
마크다운 파일로 진행 상태를 체계적으로 관리합니다.

## 🎯 주요 기능

### 1. 자동 층수 인식
- **OCR 기술**: pytesseract를 사용한 한국어/영어 텍스트 인식
- **다양한 패턴 지원**: `15층`, `15F`, `Floor 15`, `FLOOR 15` 등
- **유효성 검증**: 1-200층 범위 내에서만 인식

### 2. 스마트 스크린샷 관리
- **한 번만 촬영**: 각 층수별로 승리/패배 스크린샷을 단 한 번만 저장
- **자동 분류**: `screenshots/victory/` 및 `screenshots/defeat/` 디렉토리로 자동 분류
- **파일명 규칙**: `victory_floor_015.png`, `defeat_floor_050.png` 형태

### 3. 마크다운 진행 상태 관리
- **실시간 업데이트**: 매 승리/패배 후 자동으로 `progress/tower_progress.md` 업데이트
- **상세 통계**: 층수별 클리어 상태, 시도 횟수, 클리어 시간 등
- **시각적 표시**: 테이블 형태로 한눈에 볼 수 있는 진행 상태

## 🔧 설치 및 설정

### 1. OCR 라이브러리 설치
```bash
# 자동 설치 스크립트 실행
python install_ocr.py
```

### 2. 수동 설치 (Windows)
```bash
# pytesseract 설치
pip install pytesseract Pillow

# Tesseract 바이너리 다운로드 및 설치
# https://github.com/UB-Mannheim/tesseract/wiki
```

### 3. 한국어 언어팩 설치
- Tesseract 설치 시 "Additional language data" 옵션에서 Korean 선택
- 또는 https://github.com/tesseract-ocr/tessdata 에서 `kor.traineddata` 다운로드

## 🚀 사용법

### 1. 매크로 실행
```bash
python seven_knights_macro_improved.py
```

### 2. 키보드 단축키
- **F9**: 매크로 시작/중지
- **F10**: 매크로 종료
- **F11**: 실시간 통계 확인 (층수 정보 포함)
- **F12**: 수동 스크린샷 촬영

### 3. 진행 상태 확인
- **실시간 통계**: F11 키로 현재 층수, 최대 도달 층수, 클리어 상태 확인
- **마크다운 파일**: `progress/tower_progress.md` 파일에서 상세 진행 상태 확인

## 📊 진행 상태 파일 구조

```
progress/
└── tower_progress.md     # 마크다운 형태의 진행 상태 파일

screenshots/
├── victory/              # 승리 스크린샷
│   ├── victory_floor_001.png
│   ├── victory_floor_015.png
│   └── ...
└── defeat/               # 패배 스크린샷
    ├── defeat_floor_050.png
    ├── defeat_floor_100.png
    └── ...
```

## 📝 마크다운 파일 예시

```markdown
# 무한의 탑 진행 상태

**업데이트 시간**: 2024-01-15 14:30:25
**현재 층수**: 87층
**최대 도달 층수**: 120층
**총 승리**: 87회
**총 패배**: 15회

## 층수별 진행 상태

| 층수 | 상태 | 시도 횟수 | 첫 클리어 | 마지막 시도 | 승리 스크린샷 | 패배 스크린샷 |
|------|------|----------|-----------|-------------|---------------|---------------|
|   1층 | 🏆 클리어 |  1회 | 2024-01-15 10:15:30 | 2024-01-15 10:15:30 | ✅ | ❌ |
|   2층 | 🏆 클리어 |  1회 | 2024-01-15 10:16:45 | 2024-01-15 10:16:45 | ✅ | ❌ |
|  50층 | ❌ 미클리어 |  3회 | - | 2024-01-15 12:30:15 | ❌ | ✅ |
| 120층 | ❌ 미클리어 |  5회 | - | 2024-01-15 14:25:10 | ❌ | ✅ |

## 통계
- **총 클리어 층수**: 87층
- **총 시도 횟수**: 102회
- **평균 시도 횟수**: 1.2회
- **승률**: 85.3%
```

## 🧪 테스트 도구

### 1. 층수 인식 테스트
```bash
python test_floor_recognition.py
```

기능:
- 가상 이미지 생성 및 층수 인식 테스트
- 실제 스크린샷 파일 테스트
- 기존 스크린샷 디렉토리 일괄 테스트
- OCR 설치 상태 확인

### 2. 상태 감지 테스트
```bash
python test_state_detection.py
```

## 📈 통계 시스템

### 실시간 통계 (F11)
```
📊 Seven Knights 무한의 탑 매크로 통계 (개선된 버전)
======================================================================
🕐 실행 시간: 1234.5초 (20.6분)
🎯 현재 상태: victory
📈 상태 전환 성공률: 98.5%
⚔️ 총 실행 횟수: 87
🏆 승리 횟수: 75
💀 패배 횟수: 12
📊 승률: 86.2%

🏰 층수별 진행 정보:
   현재 층수: 87층
   최대 도달 층수: 120층
   클리어한 층수: 75층
   스크린샷 촬영 층수: 87층

🔍 최근 층수 상태:
   120층: ❌ (5회 시도)
   119층: 🏆 (1회 시도)
   118층: 🏆 (1회 시도)
   117층: 🏆 (2회 시도)
   116층: 🏆 (1회 시도)
======================================================================
```

## 🔍 OCR 인식 패턴

### 지원하는 텍스트 패턴
- `15층` (한국어 기본 패턴)
- `15F` (영어 축약 패턴)
- `Floor 15` (영어 전체 패턴)
- `FLOOR 15` (대문자 패턴)
- `15번째` (한국어 서수 패턴)
- `15 층` (공백 포함 패턴)
- `15 F` (공백 포함 영어 패턴)

### 인식 프로세스
1. **스크린샷 촬영**: 승리/패배 화면에서 자동 촬영
2. **OCR 처리**: pytesseract를 통한 텍스트 추출
3. **패턴 매칭**: 정규표현식을 통한 층수 패턴 검색
4. **유효성 검증**: 1-200층 범위 내 숫자인지 확인
5. **결과 저장**: 인식된 층수 정보를 진행 상태에 반영

## 🛠️ 트러블슈팅

### OCR 관련 문제
1. **pytesseract 설치 오류**
   ```bash
   pip install pytesseract Pillow
   ```

2. **Tesseract 바이너리 없음**
   - Windows: https://github.com/UB-Mannheim/tesseract/wiki 에서 다운로드
   - Linux: `sudo apt-get install tesseract-ocr tesseract-ocr-kor`
   - Mac: `brew install tesseract tesseract-lang`

3. **한국어 인식 불가**
   - 한국어 언어팩 설치 필요
   - `kor.traineddata` 파일을 Tesseract tessdata 디렉토리에 복사

### 층수 인식 실패
1. **스크린샷 해상도 문제**
   - 게임 화면 해상도 확인
   - 텍스트가 명확하게 보이는지 확인

2. **텍스트 위치 문제**
   - 게임 UI 변경으로 인한 텍스트 위치 변경 가능
   - 스크린샷 영역 조정 필요할 수 있음

## 🔄 기존 매크로와의 차이점

### 개선된 기능
- ✅ 층수 자동 인식 및 추적
- ✅ 스마트 스크린샷 관리 (중복 방지)
- ✅ 마크다운 진행 상태 파일
- ✅ 상세한 층수별 통계
- ✅ OCR 기반 텍스트 인식

### 기존 기능 유지
- ✅ 모든 화면 상태에서 자동 플로우 진행
- ✅ 강화된 이미지 매칭 시스템
- ✅ 실시간 통계 및 모니터링
- ✅ 키보드 단축키 지원
- ✅ 로그 시스템 및 오류 처리

## 📞 지원 및 문의

문제가 발생하거나 개선 사항이 있으시면:
1. 로그 파일 (`logs/` 디렉토리) 확인
2. 테스트 스크립트로 OCR 기능 확인
3. 스크린샷 파일들을 통한 수동 검증

---

**Seven Knights 무한의 탑 매크로 층수 추적 시스템**  
*자동 층수 인식과 체계적인 진행 상태 관리로 더욱 스마트한 게임 플레이* 